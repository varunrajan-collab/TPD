<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competency Simulation</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,500;0,700;1,500&family=Work+Sans:wght@400;500;600&display=swap');

        :root {
            /* AESTHETIC: Modern Academic (Warm Paper & Indigo) */
            
            /* Backgrounds */
            --bg-body: #FAF9F6;       /* Off-White / Paper */
            --bg-card: #FFFFFF;
            --bg-neutral: #F3F4F6;    /* Cool Gray 100 */
            --bg-accent-light: #EEF2FF; /* Indigo 50 */
            
            /* Text Colors */
            --text-primary: #1E1B4B;  /* Indigo 950 */
            --text-secondary: #4B5563;/* Gray 600 */
            --text-muted: #9CA3AF;    /* Gray 400 */
            
            /* Accents */
            --accent-color: #4F46E5;  /* Indigo 600 */
            --accent-hover: #4338CA;  /* Indigo 700 */
            --accent-border: #C7D2FE; /* Indigo 200 */
            
            /* Spacing & Structure */
            --radius-card: 16px;
            --radius-btn: 8px;
            
            --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -4px rgba(0, 0, 0, 0.02);
            
            --font-heading: 'Lora', serif;
            --font-body: 'Work Sans', sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-body);
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        #app-container {
            background: var(--bg-card);
            width: 100%;
            max-width: 720px;
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-card);
            overflow: hidden;
            border: 1px solid #E5E7EB;
            display: flex;
            flex-direction: column;
            min-height: 550px;
            position: relative;
        }

        /* Progress Header */
        .header-bar {
            padding: 0;
            background: var(--bg-card);
            border-bottom: 1px solid var(--bg-neutral);
        }

        .status-bar {
            height: 4px;
            background: var(--bg-neutral);
            width: 100%;
        }
        
        .status-fill {
            height: 100%;
            background: var(--accent-color);
            width: 0%;
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Content Area */
        .content-area {
            padding: 40px 48px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* Typography */
        h1 {
            font-family: var(--font-heading);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 16px 0;
            line-height: 1.3;
        }

        h2 {
            font-family: var(--font-body);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--accent-color);
            margin: 0 0 20px 0;
            font-weight: 600;
        }

        p {
            color: var(--text-secondary);
            margin-bottom: 24px;
            font-size: 1.05rem;
        }

        /* Selection Inputs */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .input-group {
            margin-bottom: 0;
        }
        
        .input-group.full-width {
            grid-column: span 2;
        }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        select.form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #D1D5DB;
            border-radius: var(--radius-btn);
            background-color: #FFFFFF;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: var(--font-body);
            cursor: pointer;
            transition: all 0.2s;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234F46E5%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 16px top 50%;
            background-size: 10px auto;
        }

        select.form-select:hover {
            border-color: var(--accent-color);
        }

        select.form-select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px var(--bg-accent-light);
        }

        /* Scenario Styling */
        .scenario-box {
            background-color: var(--bg-body);
            border-left: 4px solid var(--accent-color);
            padding: 28px;
            margin-bottom: 32px;
            border-radius: 4px;
        }
        
        .scenario-label {
            display: block;
            font-family: var(--font-body);
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .scenario-text {
            font-family: var(--font-heading);
            font-size: 1.15rem;
            color: var(--text-primary);
            font-style: italic;
            margin: 0;
            line-height: 1.7;
        }

        /* Question & Options */
        .question-text {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: block;
        }

        .options-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        button.option-btn {
            background: white;
            border: 1px solid #D1D5DB;
            padding: 18px 24px;
            border-radius: var(--radius-btn);
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            color: var(--text-secondary);
            font-family: var(--font-body);
            position: relative;
        }

        button.option-btn:hover {
            border-color: var(--accent-color);
            background-color: var(--bg-accent-light);
            color: var(--text-primary);
        }

        .option-prefix {
            font-weight: 700;
            color: var(--accent-color);
            margin-right: 12px;
            font-size: 0.9rem;
        }

        /* Feedback Section */
        .feedback-section {
            animation: fadeIn 0.5s ease-out;
        }

        .feedback-card {
            background: var(--bg-neutral);
            border-radius: var(--radius-card);
            padding: 32px;
            margin-bottom: 24px;
            border: 1px solid #E5E7EB;
        }
        
        .feedback-title {
            font-family: var(--font-body);
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .feedback-text {
            color: var(--text-primary);
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .analysis-block {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #E5E7EB;
        }

        .retry-prompt {
            margin-top: 20px;
            font-weight: 600;
            color: var(--accent-color);
            font-size: 1rem;
        }

        /* Buttons */
        .primary-btn {
            background-color: var(--text-primary);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: var(--radius-btn);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .primary-btn:hover {
            background-color: var(--accent-color);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
        }

        .restart-btn {
            background: transparent;
            border: 2px solid var(--text-primary);
            color: var(--text-primary);
            padding: 14px 32px;
            border-radius: var(--radius-btn);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .restart-btn:hover {
            background: var(--text-primary);
            color: white;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div id="app-container">
    <div class="header-bar">
        <div class="status-bar">
            <div class="status-fill" id="progress"></div>
        </div>
    </div>
    <div id="content" class="content-area">
        <!-- Dynamic Content -->
    </div>
</div>

<script>
    // --- CONTEXT ENGINE: SUBJECT & GRADE LOGIC ---
    // Defines the specific content, hooks, and misconceptions per grade/subject
    const contextMap = {
        "1-2": {
            "Mathematics": {
                topic: "basic addition and subtraction",
                hook_misaligned: "writing '5 + 3 = ?' on the chalkboard without speaking",
                hook_aligned: "bringing out a jar of marbles to demonstrate 'adding more'",
                misconception: "thinking the equal sign means 'the answer is' rather than 'is the same as'",
                skill_gap: "counting on fingers vs. mental grouping",
                community_resource: "a local shopkeeper to talk about counting change"
            },
            "Languages": {
                topic: "sight words and simple sentences",
                hook_misaligned: "writing a list of 10 words and asking them to copy them",
                hook_aligned: "holding up a mystery object and asking them to describe it",
                misconception: "guessing words based on pictures rather than decoding",
                skill_gap: "letter formation vs. knowing the sound",
                community_resource: "a grandparent to tell a folktale"
            },
            "Science": {
                topic: "the five senses",
                hook_misaligned: "reading the definitions of sight, sound, and smell from the book",
                hook_aligned: "passing around a 'mystery bag' to guess objects by touch",
                misconception: "thinking taste and smell are the same thing",
                skill_gap: "observing vs. inferring (guessing)",
                community_resource: "a gardener to talk about smelling flowers and feeling soil"
            }
        },
        "3-4": {
            "Mathematics": {
                topic: "multiplication and division",
                hook_misaligned: "starting a timer and demanding they solve 20 problems",
                hook_aligned: "arranging the desks into equal rows to show an array",
                misconception: "thinking multiplication always results in a bigger number (confused by x0 or x1)",
                skill_gap: "memorizing tables vs. understanding repeated addition",
                community_resource: "a carpenter to measure wood for furniture"
            },
            "Languages": {
                topic: "reading comprehension and inference",
                hook_misaligned: "reading a text aloud while they sit silently",
                hook_aligned: "showing the cover of a book and asking 'What do you think happens?'",
                misconception: "thinking reading is just saying the words right, not understanding meaning",
                skill_gap: "decoding speed vs. comprehension depth",
                community_resource: "a local journalist to talk about asking questions"
            },
            "Science": {
                topic: "water cycle and weather",
                hook_misaligned: "drawing a complex diagram on the board and labeling it",
                hook_aligned: "bringing in a glass of ice water to watch it 'sweat'",
                misconception: "thinking clouds are made of gas/smoke rather than water droplets",
                skill_gap: "recording data vs. interpreting data",
                community_resource: "a farmer to explain why rain patterns matter"
            }
        },
        "5": {
            "Mathematics": {
                topic: "fractions and decimals",
                hook_misaligned: "writing the rule 'invert and multiply' on the board",
                hook_aligned: "discussing how to split a restaurant bill or pizza fairly",
                misconception: "thinking 0.10 is larger than 0.9 because 10 is bigger than 9",
                skill_gap: "procedural calculation vs. estimation",
                community_resource: "a baker to talk about measuring ingredients"
            },
            "Languages": {
                topic: "persuasive writing",
                hook_misaligned: "assigning a 500-word essay on 'Pollution'",
                hook_aligned: "reading a controversial headline and asking for opinions",
                misconception: "thinking an argument is just shouting your opinion",
                skill_gap: "structuring an argument vs. listing complaints",
                community_resource: "a town council member to discuss local issues"
            },
            "Science": {
                topic: "ecosystems and interdependence",
                hook_misaligned: "listing the producers, consumers, and decomposers",
                hook_aligned: "asking 'What would happen if all the bees disappeared tomorrow?'",
                misconception: "thinking plants get food from the soil, not the sun",
                skill_gap: "identifying parts vs. understanding systems",
                community_resource: "a park ranger to discuss local wildlife protection"
            }
        }
    };

    // --- COMPETENCY GENERATOR ---
    const getCompetencies = (grade, subject) => {
        const ctx = contextMap[grade][subject];
        
        return [
            {
                id: 0,
                title: "Clearly communicates the lesson’s objectives and key concepts at the outset",
                level1: {
                    scenario: `You are about to start a **${grade}** lesson on **${ctx.topic}**. Students are settling in, chatting, and organizing their desks. You need to transition them into learning mode.`,
                    question: "How do you begin the lesson to ensure clear focus?",
                    options: [
                        { id: "A", label: "Option A", text: "Immediately review the previous day's homework errors.", type: "confusing", consequence: "Students focus on past mistakes rather than the new goal.", explanation: "Prioritizes administrative correction over instructional clarity." },
                        { id: "B", label: "Option B", text: `Explicitly state: 'Today we will explore ${ctx.topic} so that you can...'`, type: "aligned", consequence: "Students understand the destination and 'hook' of the lesson.", explanation: "Framing the objective helps students organize incoming information." },
                        { id: "C", label: "Option C", text: "Instruct them to open their textbooks and read silently.", type: "misaligned", consequence: "Students comply mechanically but lack mental engagement.", explanation: "Assigning a task without context creates passive compliance." }
                    ]
                },
                level2: {
                    scenario: "A student interrupts and asks: 'Why do we even need to learn this? I'll never use it.'",
                    question: "How do you respond?",
                    options: [
                        { id: "A", label: "Option A", text: "Explain a specific real-world scenario where this skill is essential.", type: "aligned", consequence: "The student perks up, realizing the concept has value.", explanation: "Validating the utility of the objective increases buy-in." },
                        { id: "B", label: "Option B", text: "Tell them it's required for the upcoming standardized test.", type: "misaligned", consequence: "Motivation shifts to fear and compliance.", explanation: "External pressure bypasses intrinsic motivation." },
                        { id: "C", label: "Option C", text: "Ask them to save all questions for the end of class.", type: "confusing", consequence: "The teachable moment is lost; curiosity is stifled.", explanation: "Prioritizing the timeline over understanding reduces engagement." }
                    ]
                },
                takeaway: "Clear communication of goals—and the 'why'—helps students stay focused."
            },
            {
                id: 1,
                title: "Differentiates between concept, skill, and essential information",
                level1: {
                    scenario: `You are planning a unit on **${ctx.topic}**. You want to ensure deep understanding, not just surface-level memorization.`,
                    question: "How do you frame your learning outcomes?",
                    options: [
                        { id: "A", label: "Option A", text: "List every fact and definition they need to memorize.", type: "misaligned", consequence: "Students focus on rote memorization, missing the big picture.", explanation: "Treating all information as equal clutters the learning path." },
                        { id: "B", label: "Option B", text: "Distinguish the core Concept from the mechanical Skill.", type: "aligned", consequence: "Planning is sharper; you design distinct activities for understanding vs. doing.", explanation: "Separating concept and skill allows for targeted teaching." },
                        { id: "C", label: "Option C", text: `Write a broad goal: 'Learn about ${ctx.topic}.'`, type: "confusing", consequence: "Assessment becomes vague and difficult.", explanation: "Vague goals lead to vague instruction." }
                    ]
                },
                level2: {
                    scenario: `Students seem to grasp the general idea but keep making the mistake of ${ctx.misconception}.`,
                    question: "What is your next instructional move?",
                    options: [
                        { id: "A", label: "Option A", text: "Design a specific practice activity addressing that misconception.", type: "aligned", consequence: "Students bridge the gap and correct their mental model.", explanation: "Identifying specific breakdowns allows for targeted remediation." },
                        { id: "B", label: "Option B", text: "Re-explain the definition from the start.", type: "misaligned", consequence: "Students tune out; they already know the definition.", explanation: "Restating the concept doesn't fix a specific misunderstanding." },
                        { id: "C", label: "Option C", text: "Move on to the next chapter to stay on schedule.", type: "confusing", consequence: "The misconception becomes permanent.", explanation: "Ignoring gaps ensures future struggle." }
                    ]
                },
                takeaway: "Distinguishing between concepts (knowing) and skills (doing) ensures comprehensive learning."
            },
            {
                id: 2,
                title: "Identifies a central theme that can connect different subjects",
                level1: {
                    scenario: `You are teaching **${ctx.topic}** in ${subject}. You want to connect it to other subjects to make learning holistic.`,
                    question: "How do you organize the unit?",
                    options: [
                        { id: "A", label: "Option A", text: "Follow the textbook order exactly for each subject.", type: "misaligned", consequence: "Subjects remain isolated silos.", explanation: "Misses opportunities for holistic learning." },
                        { id: "B", label: "Option B", text: "Choose a theme (e.g., 'Patterns') that links this topic to others.", type: "aligned", consequence: "Students start seeing connections across domains.", explanation: "Thematic planning reinforces concepts." },
                        { id: "C", label: "Option C", text: "Pick a theme but only apply it to Art class.", type: "confusing", consequence: "The theme feels like a decoration.", explanation: "Superficial integration doesn't deepen understanding." }
                    ]
                },
                level2: {
                    scenario: "Students ask: 'Why are we talking about this here? This feels like a different subject.'",
                    question: "How do you leverage the theme?",
                    options: [
                        { id: "A", label: "Option A", text: "Explicitly explain the connection between the subjects.", type: "aligned", consequence: "Students understand the transferability of knowledge.", explanation: "Reinforcing the theme validates the approach." },
                        { id: "B", label: "Option B", text: "Tell them to just focus on the task at hand.", type: "misaligned", consequence: "The connection is severed.", explanation: "Dismissing the connection undermines the plan." },
                        { id: "C", label: "Option C", text: "Say 'We are done with that subject now.'", type: "confusing", consequence: "Students compartmentalize their thinking.", explanation: "Rigid boundaries hinder transfer." }
                    ]
                },
                takeaway: "Thematic planning creates a cohesive learning experience."
            },
            {
                id: 3,
                title: "Identifies relevant community resources to enrich classroom activities",
                level1: {
                    scenario: `You are teaching **${ctx.topic}**. You want to move beyond the textbook description and bring the topic to life.`,
                    question: "What resource do you bring in?",
                    options: [
                        { id: "A", label: "Option A", text: `Invite ${ctx.community_resource} to speak to the class.`, type: "aligned", consequence: "Students ask real questions and gain respect for the topic.", explanation: "Human resources bring abstract concepts to life." },
                        { id: "B", label: "Option B", text: "Read the textbook chapter aloud twice.", type: "misaligned", consequence: "Engagement is low; learning remains theoretical.", explanation: "Repetition doesn't equal enrichment." },
                        { id: "C", label: "Option C", text: "Show a video from a foreign country.", type: "confusing", consequence: "Students disconnect it from their own reality.", explanation: "Contextual relevance is key." }
                    ]
                },
                level2: {
                    scenario: "The guest speaker arrives but is nervous and silent in front of the class.",
                    question: "How do you facilitate?",
                    options: [
                        { id: "A", label: "Option A", text: "Have student-prepared questions ready to prompt them.", type: "aligned", consequence: "The session flows smoothly; students feel ownership.", explanation: "Preparation scaffolds the interaction." },
                        { id: "B", label: "Option B", text: "Sit back and wait for them to start.", type: "misaligned", consequence: "Awkward silence ensues.", explanation: "Unstructured interactions can fail." },
                        { id: "C", label: "Option C", text: "Take over and lecture about the topic yourself.", type: "confusing", consequence: "The guest becomes a prop.", explanation: "The goal is to hear the community voice." }
                    ]
                },
                takeaway: "Community resources connect the classroom to the real world."
            },
            {
                id: 4,
                title: "Guides students in using textbook features (tables, headings, visuals)",
                level1: {
                    scenario: `You are introducing a dense chapter on **${ctx.topic}**. Students look overwhelmed by the amount of text.`,
                    question: "How do you start reading?",
                    options: [
                        { id: "A", label: "Option A", text: "Do a 'textbook walk': discuss headings and pictures first.", type: "aligned", consequence: "Students build a mental scaffold for the content.", explanation: "Pre-reading activates prior knowledge." },
                        { id: "B", label: "Option B", text: "Start reading paragraph 1 immediately.", type: "misaligned", consequence: "Students get lost in details.", explanation: "Diving in increases cognitive load." },
                        { id: "C", label: "Option C", text: "Ignore pictures, focus on bold words.", type: "confusing", consequence: "Students miss visual context.", explanation: "Visuals are key learning aids." }
                    ]
                },
                level2: {
                    scenario: "A student is stuck on a difficult paragraph and is staring blankly.",
                    question: "How do you guide them?",
                    options: [
                        { id: "A", label: "Option A", text: "Ask: 'What does the chart next to this text tell you?'", type: "aligned", consequence: "Student connects visual to text to decode meaning.", explanation: "Using features decodes info." },
                        { id: "B", label: "Option B", text: "Read it aloud to them.", type: "misaligned", consequence: "Student builds dependency.", explanation: "Solves immediate problem, not the skill gap." },
                        { id: "C", label: "Option C", text: "Tell them to skip it.", type: "confusing", consequence: "Student learns to avoid difficulty.", explanation: "Avoidance is not a strategy." }
                    ]
                },
                takeaway: "Textbooks are tools; navigation skills build independence."
            },
            {
                id: 5,
                title: "Creates a context/hook using questions, stories, or prompts",
                level1: {
                    scenario: `You are introducing **${ctx.topic}**. You want to ensure student buy-in before teaching the mechanics.`,
                    question: "How do you introduce the topic?",
                    options: [
                        { id: "A", label: "Option A", text: `Start by ${ctx.hook_misaligned}.`, type: "misaligned", consequence: "Students feel anxious or bored.", explanation: "Abstract mechanics create resistance." },
                        { id: "B", label: "Option B", text: `Start by ${ctx.hook_aligned}.`, type: "aligned", consequence: "Students immediately offer ideas/solutions.", explanation: "Contextualizing makes the abstract accessible." },
                        { id: "C", label: "Option C", text: "Read the definition from the book.", type: "confusing", consequence: "Memorization without understanding.", explanation: "Definitions should follow understanding." }
                    ]
                },
                level2: {
                    scenario: "A student gives a simple, intuitive answer. You want to deepen their thinking.",
                    question: "How do you respond?",
                    options: [
                        { id: "A", label: "Option A", text: "Ask a 'What if' probing question.", type: "aligned", consequence: "Students debate and refine their thinking.", explanation: "Probing deepens context." },
                        { id: "B", label: "Option B", text: "Say 'Correct' and move on.", type: "misaligned", consequence: "Thinking stops.", explanation: "Stopping at the first right answer limits depth." },
                        { id: "C", label: "Option C", text: "Say 'No, look at the rule.'", type: "confusing", consequence: "Confusion between intuition and rule.", explanation: "Disconnecting intuition hinders understanding." }
                    ]
                },
                takeaway: "A good hook bridges the student's world and the curriculum."
            }
        ];
    };

    // --- STATE ---
    const contentDiv = document.getElementById('content');
    const progressBar = document.getElementById('progress');
    let currentStep = 0; 
    let selectedGrade = "1-2";
    let selectedSubject = "Mathematics";
    let selectedCompetencyIndex = 0;
    let currentSimulationData = null;

    // --- RENDERERS ---

    function setProgress(pct) {
        progressBar.style.width = `${pct}%`;
    }

    // STEP 0: SELECTION SCREEN
    function renderSelection() {
        currentStep = 0;
        setProgress(5);
        
        const compTitles = [
            "Communicating Objectives",
            "Differentiating Outcomes",
            "Thematic Planning",
            "Community Resources",
            "Textbook Features",
            "Creating Hooks"
        ];
        
        const compOptions = compTitles.map((t, i) => `<option value="${i}">${t}</option>`).join('');

        contentDiv.innerHTML = `
            <div style="animation: fadeIn 0.5s ease-out;">
                <h2>Welcome</h2>
                <h1>Simulate a Classroom Scenario</h1>
                <p>Select your context to generate a realistic situation:</p>
                
                <div class="form-grid">
                    <div class="input-group">
                        <label>Grade Level</label>
                        <select id="gradeSelect" class="form-select">
                            <option value="1-2">Grades 1-2</option>
                            <option value="3-4">Grades 3-4</option>
                            <option value="5">Grade 5</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Subject</label>
                        <select id="subjectSelect" class="form-select">
                            <option value="Mathematics">Mathematics</option>
                            <option value="Languages">Languages</option>
                            <option value="Science">Science</option>
                        </select>
                    </div>

                    <div class="input-group full-width">
                        <label>Target Competency</label>
                        <select id="compSelect" class="form-select">
                            ${compOptions}
                        </select>
                    </div>
                </div>

                <button class="primary-btn" onclick="startSimulation()">Start Simulation</button>
            </div>
        `;
    }

    function startSimulation() {
        selectedGrade = document.getElementById('gradeSelect').value;
        selectedSubject = document.getElementById('subjectSelect').value;
        selectedCompetencyIndex = parseInt(document.getElementById('compSelect').value);
        
        const allCompetencies = getCompetencies(selectedGrade, selectedSubject);
        currentSimulationData = allCompetencies[selectedCompetencyIndex];
        
        renderLevel1();
    }

    // STEP 2: LEVEL 1
    function renderLevel1() {
        currentStep = 1;
        setProgress(33);
        const data = currentSimulationData.level1;
        const optionsHTML = data.options.map(opt => `
            <button class="option-btn" onclick="handleDecision('level1', '${opt.type}', '${opt.id}')">
                <span class="option-prefix">${opt.label}:</span> ${opt.text}
            </button>
        `).join('');

        contentDiv.innerHTML = `
            <div style="animation: fadeIn 0.5s ease-out;">
                <h2>${selectedSubject} • Grades ${selectedGrade}</h2>
                <h1>${currentSimulationData.title}</h1>
                
                <div class="scenario-box">
                    <span class="scenario-label">Scenario 1</span>
                    <p class="scenario-text">${data.scenario}</p>
                </div>
                
                <span class="question-text">${data.question}</span>
                <div class="options-list">
                    ${optionsHTML}
                </div>
            </div>
        `;
    }

    // STEP 3: HANDLE DECISION
    window.handleDecision = function(level, type, optId) {
        const levelData = currentSimulationData[level];
        const selectedOpt = levelData.options.find(o => o.id === optId);

        if (type === 'aligned') {
            if (level === 'level1') {
                renderLvl1Success(selectedOpt);
            } else {
                renderFinalSuccess(selectedOpt);
            }
        } else {
            renderFailure(selectedOpt, level);
        }
    };

    // STEP 4: SUCCESS FEEDBACK (LEVEL 1)
    function renderLvl1Success(option) {
        setProgress(66);
        contentDiv.innerHTML = `
            <div class="feedback-section">
                <h2>Positive Impact</h2>
                <div class="feedback-card" style="background-color: #EEF2FF; border-color: #C7D2FE;">
                    <div class="feedback-title">Outcome</div>
                    <div class="feedback-text">${option.consequence}</div>
                </div>
                <button class="primary-btn" onclick="renderLevel2()">Continue to Scenario 2</button>
            </div>
        `;
    }

    // STEP 5: LEVEL 2
    function renderLevel2() {
        currentStep = 2;
        setProgress(80);
        const data = currentSimulationData.level2;
        const optionsHTML = data.options.map(opt => `
            <button class="option-btn" onclick="handleDecision('level2', '${opt.type}', '${opt.id}')">
                <span class="option-prefix">${opt.label}:</span> ${opt.text}
            </button>
        `).join('');

        contentDiv.innerHTML = `
            <div style="animation: fadeIn 0.5s ease-out;">
                <h2>${selectedSubject} • Grades ${selectedGrade}</h2>
                <div class="scenario-box">
                    <span class="scenario-label">Scenario 2</span>
                    <p class="scenario-text">${data.scenario}</p>
                </div>
                <span class="question-text">${data.question}</span>
                <div class="options-list">
                    ${optionsHTML}
                </div>
            </div>
        `;
    }

    // FAILURE FEEDBACK
    function renderFailure(option, level) {
        setProgress(currentStep === 1 ? 33 : 80);
        const retryFunction = level === 'level1' ? 'renderLevel1()' : 'renderLevel2()';

        contentDiv.innerHTML = `
            <div class="feedback-section">
                <h2>Classroom Impact</h2>
                <div class="feedback-card">
                    <div class="feedback-title">Consequence</div>
                    <div class="feedback-text">${option.consequence}</div>
                    
                    <div class="analysis-block">
                        <div class="feedback-title">Analysis</div>
                        <div class="feedback-text">${option.explanation}</div>
                    </div>

                    <div class="retry-prompt">
                        <span style="font-size:1.2rem; margin-right:8px;">↺</span> 
                        Now that you see the impact, would you like to try a different approach?
                    </div>
                </div>
                <button class="primary-btn" onclick="${retryFunction}">Try Again</button>
            </div>
        `;
    }

    // FINAL SUCCESS
    function renderFinalSuccess(option) {
        setProgress(100);
        contentDiv.innerHTML = `
            <div class="feedback-section">
                <h2>Outcomes Achieved</h2>
                <div class="feedback-card" style="background-color: #EEF2FF; border-color: #C7D2FE;">
                    <div class="feedback-title">Immediate Result</div>
                    <div class="feedback-text">${option.consequence}</div>
                    
                    <div class="analysis-block">
                        <div class="feedback-title">Professional Takeaway</div>
                        <div class="feedback-text" style="font-weight:600; color:var(--text-primary);">${currentSimulationData.takeaway}</div>
                    </div>
                </div>
                <button class="restart-btn" onclick="renderSelection()">Select New Competency</button>
            </div>
        `;
    }

    // INITIALIZE
    renderSelection();

</script>

</body>
</html>
